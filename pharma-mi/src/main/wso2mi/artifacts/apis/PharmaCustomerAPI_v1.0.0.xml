<?xml version="1.0" encoding="UTF-8"?>
<api name="PharmaCustomerAPI" statistics="enable" trace="enable" context="/customers/1.0.0" version="1.0.0" version-type="context" xmlns="http://ws.apache.org/ns/synapse">
    <!-- GET /customers/1.0.0/patient/{patientId} -->
    <resource methods="GET" uri-template="/patient/{patientId}">
        <inSequence>
            <!-- common inbound: correlation id, IN log -->
            <sequence key="CommonInSeq"/>
            <!-- propagate correlation id as x-fapi-interaction-id -->
            <header name="x-fapi-interaction-id" scope="transport" expression="get-property('CorrelationId')"/>
            <!-- call the CustomerProfileEP (http://pharma-backend:8080/patients/profile/{id}) -->
            <send>
                <endpoint key="CustomerProfileEP"/>
            </send>
        </inSequence>
        <outSequence>
            <!-- common outbound: latency, OUT log -->
            <sequence key="CommonOutSeq"/>
            <send/>
        </outSequence>
        <faultSequence>
            <!-- common JSON fault envelope + 5xx / 502 mapping -->
            <sequence key="CommonFaultSeq"/>
        </faultSequence>
    </resource>
</api>
